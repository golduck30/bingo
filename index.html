<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìƒˆ ì±„íŒ…</title> 
    
    <meta property="og:title" content="Gemini">
    <meta property="og:description" content="Googleì˜ ìµœì‹  AI ëª¨ë¸ê³¼ ëŒ€í™”í•´ë³´ì„¸ìš”.">
    <meta property="og:image" content="https://www.gstatic.com/lamda/images/favicon_v1_150px.svg"> 
    <meta property="og:url" content="https://gemini.google.com/">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        :root {
            --gemini-bg: #ffffff;
            --gemini-sidebar: #f0f4f9;
            --gemini-text: #1f1f1f;
            --gemini-subtext: #444746;
            --gemini-blue: #1a73e8;
            --gemini-light-blue: #e8f0fe;
            --gemini-border: #e0e3e7;
            --gemini-hover: #f5f8fc;
        }

        body { font-family: 'Google Sans', 'Malgun Gothic', sans-serif; background-color: var(--gemini-bg); color: var(--gemini-text); margin: 0; padding: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        .app-container { width: 100%; max-width: 900px; display: flex; flex-direction: column; height: 100%; }
        .fake-header { padding: 15px 20px; display: flex; align-items: center; border-bottom: 1px solid var(--gemini-border); color: var(--gemini-subtext); font-size: 1.1rem; }
        .fake-header span { margin-left: 10px; font-weight: 500; }

        .main-content { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background-color: transparent; padding: 0; width: 100%; max-width: 600px; text-align: left; position: relative; }

        h1, h2 { color: var(--gemini-text); font-weight: 400; margin-bottom: 15px; }
        p { color: var(--gemini-subtext); line-height: 1.5; }

        .btn-primary { background-color: var(--gemini-blue); color: white; border: none; padding: 10px 24px; border-radius: 24px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center;}
        .btn-secondary { background-color: transparent; color: var(--gemini-blue); border: 1px solid var(--gemini-border); padding: 8px 16px; border-radius: 20px; font-weight: 500; cursor: pointer; font-size: 0.9rem; }
        
        /* ì•¡ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .action-row { display: flex; gap: 10px; width: 100%; margin-bottom: 20px; }
        .btn-call { background-color: #d93025; color: white; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; flex: 1; font-size: 1rem; }
        .btn-call:disabled { background-color: #ccc; cursor: not-allowed; }
        .btn-me-too { background-color: #1a73e8; color: white; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; flex: 1; font-size: 1rem; }

        .login-input, .setup-input, .chat-input { padding: 12px 16px; font-size: 1rem; border: 1px solid var(--gemini-border); border-radius: 24px; width: 100%; box-sizing: border-box; outline: none; background: var(--gemini-bg); color: var(--gemini-text);}
        #loginScreen, #setupScreen, #waitingScreen, #mainBoard { display: none; flex-direction: column; width: 100%; } #loginScreen { display: flex; }

        .setup-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; margin: 20px 0; }
        .setup-input { border-radius: 8px; text-align: center; padding: 5px; font-size: 0.9rem; }

        .broadcaster { background: var(--gemini-hover); color: var(--gemini-text); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--gemini-blue); display: flex; align-items: flex-start; }
        .turn-alert { background: transparent; color: var(--gemini-subtext); padding: 10px 0; margin-bottom: 10px; font-weight: 500; border-bottom: 1px solid var(--gemini-border); }
        .turn-alert.my-turn { color: var(--gemini-blue); font-weight: bold; }

        .leaderboard { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .player-badge { background: var(--gemini-sidebar); border: 1px solid var(--gemini-border); padding: 4px 12px; border-radius: 16px; font-size: 0.85rem; color: var(--gemini-subtext); }
        .player-badge.active-turn { background: var(--gemini-light-blue); color: var(--gemini-blue); border-color: var(--gemini-blue); font-weight: 600; }

        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1px; background: var(--gemini-border); border: 1px solid var(--gemini-border); border-radius: 8px; overflow: hidden; margin-bottom: 15px; }
        .bingo-cell { background-color: var(--gemini-bg); aspect-ratio: 1 / 1; display: flex; justify-content: center; align-items: center; padding: 4px; font-size: 0.85rem; color: var(--gemini-text); cursor: pointer; user-select: none; transition: 0.2s; word-break: break-word; position: relative; text-align: center; }
        .bingo-cell.stamped { background-color: var(--gemini-light-blue); color: var(--gemini-blue); font-weight: 600; }
        .bingo-cell.stamped::after { content: 'âœ“'; position: absolute; top: 2px; right: 4px; font-size: 1rem; color: var(--gemini-blue); opacity: 0.7; }
        /* ë°©ê¸ˆ ì„ íƒí•œ ì¹¸ ê°•ì¡° */
        .bingo-cell.last-clicked { border: 2.5px solid var(--gemini-blue); z-index: 5; }

        .chat-container { border-top: 1px solid var(--gemini-border); padding-top: 20px; display: flex; flex-direction: column; height: 250px; }
        .chat-messages { flex: 1; overflow-y: auto; padding-right: 5px; display: flex; flex-direction: column; gap: 10px; }
        .chat-msg { display: flex; flex-direction: column; max-width: 85%; }
        .chat-msg.mine { align-self: flex-end; align-items: flex-end; }
        .chat-sender { font-size: 0.75rem; color: var(--gemini-subtext); margin-bottom: 2px; }
        .chat-bubble { background: var(--gemini-sidebar); padding: 8px 12px; border-radius: 16px; border-top-left-radius: 4px; color: var(--gemini-text); font-size: 0.9rem; }
        .chat-msg.mine .chat-bubble { background: var(--gemini-light-blue); border-radius: 16px; border-top-right-radius: 4px; }
        
        .chat-input-row { display: flex; gap: 10px; margin-top: 10px; align-items: center; background: var(--gemini-bg); padding: 5px; border-radius: 30px; border: 1px solid var(--gemini-border); }
        .chat-input { border: none; padding: 8px 15px; flex: 1; border-radius: 0; background: transparent; outline: none; }
        
        #winnerOverlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); flex-direction: column; align-items: center; justify-content: center; z-index: 10; backdrop-filter: blur(5px); }
        @media (max-width: 500px) { .setup-input, .bingo-cell { font-size: 0.75rem; } }
    </style>
</head>
<body>

<div class="app-container">
    <div class="fake-header">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" fill="#1a73e8"/></svg>
        <span>Gemini Advanced (ì—…ë¬´ ë³´ì¡°)</span>
    </div>

    <div class="main-content">
        <div class="container" id="loginScreen">
            <h1>ì˜¤ëŠ˜ì˜ ì—…ë¬´ í˜‘ì—… ì„¸ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.</h1>
            <div class="subject-box">ì£¼ì œ: <strong id="loginSubjectText" style="margin-left: 5px; color: var(--gemini-blue);">ë°ì´í„° ì—°ê²° ì¤‘...</strong></div>
            <div style="display: flex; gap: 10px; width: 100%;">
                <input type="text" id="playerName" class="login-input" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" onkeypress="if(event.key==='Enter') enterSetup()">
                <button class="btn-primary" onclick="enterSetup()">ì°¸ì—¬</button>
            </div>
        </div>

        <div class="container" id="setupScreen">
            <h2>ë°ì´í„° ì…ë ¥ ë‹¨ê³„</h2>
            <div class="setup-grid" id="setupGrid"></div>
            <button class="btn-primary" style="width: 100%;" onclick="submitBoard()">ì…ë ¥ ì™„ë£Œ</button>
        </div>

        <div class="container" id="waitingScreen">
            <h2>ì°¸ì—¬ì ëŒ€ê¸° ì¤‘</h2>
            <div class="wait-list" id="readyPlayerList"></div>
            <button class="btn-primary" style="width: 100%;" onclick="startGame()">ì„¸ì…˜ ì‹œì‘</button>
        </div>

        <div class="container" id="mainBoard">
            <div id="winnerOverlay">
                <h2 style="color: var(--gemini-blue);">ğŸ‰ ì„¸ì…˜ ì¢…ë£Œ</h2>
                <p id="winnerNameDisplay"></p>
                <button class="btn-secondary" onclick="resetAllGame()">ìƒˆ ì„¸ì…˜ ì‹œì‘</button>
            </div>

            <div id="turnAlertBox" class="turn-alert">ìƒíƒœ í™•ì¸ ì¤‘...</div>
            <div class="broadcaster" id="broadcasterDisplay">ìµœê·¼ ê³µìœ ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>

            <div class="action-row">
                <button id="btnCallAction" class="btn-call" onclick="emitSelectedWord()" disabled>ğŸ“¢ ì´ê±° ìˆëƒ? (í„´ ì „ì†¡)</button>
                <button id="btnMeToo" class="btn-me-too" onclick="sendMeToo()">âœ‹ ë‚˜ë„ ìˆë‹¤! (ì±„íŒ… ì „ì†¡)</button>
            </div>

            <div style="display:flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 10px;">
                <span style="font-weight: 500; color: var(--gemini-blue);" id="myStatusText">ë‚´ ì§„í–‰ë„: 0%</span>
                <button class="btn-secondary" onclick="resetAllGame()" style="font-size:0.8rem; padding: 4px 10px;">ì„¸ì…˜ ì´ˆê¸°í™”</button>
            </div>

            <div class="bingo-grid" id="bingoGrid"></div>

            <div class="chat-container">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-row">
                    <input type="text" id="chatInput" class="chat-input" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeypress="if(event.key==='Enter') sendChat()">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBZmxJUr5oaZttF7oIYJSEBb5RgjVQjInY",
        authDomain: "cofirm-board.firebaseapp.com",
        databaseURL: "https://cofirm-board-default-rtdb.firebaseio.com",
        projectId: "cofirm-board",
        storageBucket: "cofirm-board.firebasestorage.app",
        messagingSenderId: "367825644618",
        appId: "1:367825644618:web:3f236c72c07d5347878ab3"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const gameRef = db.ref('turn_bingo'); 
    const chatRef = db.ref('turn_bingo/chat');
    
    let myName = "", myBoardRef = null, turnOrderList = [], currentTurnPlayer = "";
    let lastSelectedWord = ""; // ë°©ê¸ˆ ë‚´ê°€ í´ë¦­í•´ì„œ ì²´í¬í•œ ë‹¨ì–´ ì €ì¥

    gameRef.child('subject').on('value', snap => {
        document.getElementById('loginSubjectText').innerText = snap.val() || "ì¼ë°˜ ì—…ë¬´ ë…¼ì˜";
    });

    function enterSetup() {
        const val = document.getElementById('playerName').value.trim();
        if(!val) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");
        myName = val; myBoardRef = gameRef.child('players').child(myName);
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('setupScreen').style.display = 'flex';
        const grid = document.getElementById('setupGrid'); grid.innerHTML = '';
        for(let i=0; i<25; i++) {
            const input = document.createElement('input'); input.type = 'text'; input.className = 'setup-input'; input.id = `input_cell_${i}`;
            grid.appendChild(input);
        }
    }

    function submitBoard() {
        const newBoard = {};
        for(let i=0; i<25; i++) {
            const val = document.getElementById(`input_cell_${i}`).value.trim();
            if(!val) return alert("ë°ì´í„°ë¥¼ ëª¨ë‘ ì±„ì›Œì£¼ì„¸ìš”.");
            newBoard[i] = { text: val, stamped: false };
        }
        myBoardRef.set({ ready: true, readyAt: firebase.database.ServerValue.TIMESTAMP, lines: 0, board: newBoard });
        document.getElementById('setupScreen').style.display = 'none';
        document.getElementById('waitingScreen').style.display = 'flex';
        listenToWaitingRoom();
    }

    function listenToWaitingRoom() {
        gameRef.child('players').on('value', snap => {
            const list = document.getElementById('readyPlayerList'); list.innerHTML = '';
            for(let key in snap.val()) {
                if(snap.val()[key].ready) {
                    const div = document.createElement('div'); div.className = 'wait-item'; div.innerText = key; list.appendChild(div);
                }
            }
        });
        gameRef.child('state').on('value', snap => {
            if(snap.val() && snap.val().isStarted) {
                document.getElementById('waitingScreen').style.display = 'none';
                document.getElementById('mainBoard').style.display = 'flex';
                startMainGameListeners();
            }
        });
    }

    function startGame() {
        gameRef.child('players').once('value', snap => {
            let sorted = [];
            for(let k in snap.val()) { if(snap.val()[k].ready) sorted.push({ n: k, t: snap.val()[k].readyAt }); }
            sorted.sort((a,b) => a.t - b.t);
            gameRef.child('state').set({ isStarted: true, turnOrder: sorted.map(x => x.n), turnIndex: 0, lastCalledWord: "", lastCaller: "" });
        });
    }

    function startMainGameListeners() {
        myBoardRef.child('board').on('value', snap => {
            if(!snap.val()) return;
            const grid = document.getElementById('bingoGrid'); grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cellData = snap.val()[i];
                const cell = document.createElement('div');
                cell.className = 'bingo-cell' + (cellData.stamped ? ' stamped' : '');
                // ë‚´ê°€ ë°©ê¸ˆ í´ë¦­í•œ ë‹¨ì–´ë©´ íŒŒë€ í…Œë‘ë¦¬ í‘œì‹œ
                if (cellData.text === lastSelectedWord) cell.classList.add('last-clicked');
                
                cell.innerText = cellData.text;
                cell.onclick = () => {
                    // í´ë¦­ ì‹œ í•´ë‹¹ ë‹¨ì–´ë¥¼ 'ë§ˆì§€ë§‰ ì„ íƒ ë‹¨ì–´'ë¡œ ì €ì¥
                    lastSelectedWord = cellData.text;
                    myBoardRef.child('board').child(i).update({ stamped: !cellData.stamped });
                };
                grid.appendChild(cell);
            }
            checkMyBingo(snap.val());
        });

        gameRef.child('state').on('value', snap => {
            const state = snap.val(); if(!state) return;
            turnOrderList = state.turnOrder || []; currentTurnPlayer = turnOrderList[state.turnIndex];
            
            const btnCall = document.getElementById('btnCallAction');
            if (currentTurnPlayer === myName) {
                document.getElementById('turnAlertBox').className = "turn-alert my-turn";
                document.getElementById('turnAlertBox').innerText = "âœ¨ ê·€í•˜ì˜ ë°œì–¸ ì°¨ë¡€ì…ë‹ˆë‹¤. ì¹¸ ì„ íƒ í›„ 'ì´ê±° ìˆëƒ?' í´ë¦­";
                btnCall.disabled = false;
            } else {
                document.getElementById('turnAlertBox').className = "turn-alert";
                document.getElementById('turnAlertBox').innerText = `í˜„ì¬ ë°œì–¸ì: [ ${currentTurnPlayer} ]ë‹˜`;
                btnCall.disabled = true;
            }

            if (state.lastCalledWord) {
                document.getElementById('broadcasterDisplay').innerHTML = `ğŸ“¢ <strong>${state.lastCaller}</strong>ë‹˜ì´ ê³µìœ í•œ í‚¤ì›Œë“œ: <span style="color:var(--gemini-blue)">[ ${state.lastCalledWord} ]</span>`;
                // ìë™ ë„ì¥
                myBoardRef.child('board').once('value', bSnap => {
                    const board = bSnap.val();
                    for(let k in board) {
                        if(board[k].text === state.lastCalledWord && !board[k].stamped) {
                            myBoardRef.child('board').child(k).update({ stamped: true });
                        }
                    }
                });
            }
            if(state.isGameOver) {
                document.getElementById('winnerOverlay').style.display = 'flex';
                document.getElementById('winnerNameDisplay').innerText = `[ ${state.winnerName} ]ë‹˜ì´ ìµœì¢… ëª©í‘œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.`;
            }
        });
        startChat();
    }

    // [ì´ê±° ìˆëƒ?] - ë°©ê¸ˆ ì²´í¬í•œ ë‹¨ì–´ ì™¸ì¹˜ê¸°
    window.emitSelectedWord = function() {
        if (!lastSelectedWord) return alert("ì™¸ì¹  ë‹¨ì–´ë¥¼ ë¨¼ì € í´ë¦­(ì²´í¬)í•´ì£¼ì„¸ìš”.");
        if(confirm(`'${lastSelectedWord}'(ì„)ë¥¼ ê³µìœ í•˜ê³  í„´ì„ ë„˜ê¸°ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            gameRef.child('state').once('value', s => {
                const st = s.val();
                const next = (st.turnIndex + 1) % st.turnOrder.length;
                gameRef.child('state').update({ lastCalledWord: lastSelectedWord, lastCaller: myName, turnIndex: next });
                lastSelectedWord = ""; // ì „ì†¡ í›„ ì´ˆê¸°í™”
            });
        }
    };

    // [ë‚˜ë„ ìˆë‹¤!] - ë°©ê¸ˆ ì²´í¬í•œ ë‹¨ì–´ë¥¼ ì±„íŒ…ìœ¼ë¡œ ì „ì†¡
    window.sendMeToo = function() {
        if (!lastSelectedWord) {
            chatRef.push({ type: 'user', sender: myName, msg: "ë‚˜ë„ ìˆë‹¤! â­•" }); // ë‹¨ì–´ ì„ íƒ ì•ˆí–ˆìœ¼ë©´ ê·¸ëƒ¥ ë©”ì‹œì§€ë§Œ
        } else {
            chatRef.push({ type: 'user', sender: myName, msg: `${lastSelectedWord} ë‚˜ë„ ìˆë‹¤! â­•` });
        }
    };

    function checkMyBingo(board) {
        let lines = 0; const b = Object.values(board);
        for(let i=0; i<5; i++){
            if(b[i*5].stamped && b[i*5+1].stamped && b[i*5+2].stamped && b[i*5+3].stamped && b[i*5+4].stamped) lines++;
            if(b[i].stamped && b[i+5].stamped && b[i+10].stamped && b[i+15].stamped && b[i+20].stamped) lines++;
        }
        if(b[0].stamped && b[6].stamped && b[12].stamped && b[18].stamped && b[24].stamped) lines++;
        if(b[4].stamped && b[8].stamped && b[12].stamped && b[16].stamped && b[20].stamped) lines++;
        document.getElementById('myStatusText').innerText = `ë‚´ ì§„í–‰ë„: ${lines*20}%`;
        myBoardRef.update({ lines: lines });
        if(lines >= 5) gameRef.child('state').update({ isGameOver: true, winnerName: myName });
    }

    function startChat() {
        if(isChatActive) return; isChatActive = true;
        chatRef.limitToLast(20).on('child_added', snap => {
            const d = snap.val(); const box = document.getElementById('chatMessages');
            const div = document.createElement('div'); div.className = 'chat-msg' + (d.sender === myName ? ' mine' : '');
            div.innerHTML = `<div class="chat-sender">${d.sender || 'ì‹œìŠ¤í…œ'}</div><div class="chat-bubble">${d.msg}</div>`;
            box.appendChild(div); box.scrollTop = box.scrollHeight;
        });
    }

    window.sendChat = function() {
        const i = document.getElementById('chatInput');
        if(i.value.trim()) { chatRef.push({ type: 'user', sender: myName, msg: i.value.trim() }); i.value = ''; }
    }
    window.resetAllGame = function() { if(confirm("ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) gameRef.remove().then(() => location.reload()); }
</script>
</body>
</html>
