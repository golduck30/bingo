<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìƒˆ ì±„íŒ…</title> <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* Gemini í…Œë§ˆ ì ìš© */
        :root {
            --gemini-bg: #ffffff;
            --gemini-sidebar: #f0f4f9;
            --gemini-text: #1f1f1f;
            --gemini-subtext: #444746;
            --gemini-blue: #1a73e8;
            --gemini-light-blue: #e8f0fe;
            --gemini-border: #e0e3e7;
            --gemini-hover: #f5f8fc;
        }

        body { font-family: 'Google Sans', Roboto, Arial, sans-serif; background-color: var(--gemini-bg); color: var(--gemini-text); margin: 0; padding: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        .app-container { width: 100%; max-width: 900px; display: flex; flex-direction: column; height: 100%; }
        
        /* ìƒë‹¨ í—¤ë” (ìœ„ì¥ìš©) */
        .fake-header { padding: 15px 20px; display: flex; align-items: center; border-bottom: 1px solid var(--gemini-border); color: var(--gemini-subtext); font-size: 1.1rem; }
        .fake-header span { margin-left: 10px; font-weight: 500; }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .main-content { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background-color: transparent; padding: 0; width: 100%; max-width: 600px; text-align: left; position: relative; }

        /* ê³µí†µ UI ìš”ì†Œ (ì œë¯¸ë‚˜ì´ ìŠ¤íƒ€ì¼) */
        h1, h2 { color: var(--gemini-text); font-weight: 400; margin-bottom: 15px; }
        p { color: var(--gemini-subtext); line-height: 1.5; }

        /* ë²„íŠ¼ */
        .btn-primary { background-color: var(--gemini-blue); color: white; border: none; padding: 10px 24px; border-radius: 24px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center;}
        .btn-primary:hover { background-color: #1557b0; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .btn-secondary { background-color: transparent; color: var(--gemini-blue); border: 1px solid var(--gemini-border); padding: 8px 16px; border-radius: 20px; font-weight: 500; cursor: pointer; font-size: 0.9rem; }
        .btn-secondary:hover { background-color: var(--gemini-hover); }

        /* ì…ë ¥ì°½ */
        .login-input, .setup-input, .chat-input { padding: 12px 16px; font-size: 1rem; border: 1px solid var(--gemini-border); border-radius: 24px; width: 100%; box-sizing: border-box; outline: none; transition: 0.2s; background: var(--gemini-bg); color: var(--gemini-text);}
        .login-input:focus, .setup-input:focus, .chat-input:focus { border-color: var(--gemini-blue); background-color: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.1); }

        /* í™”ë©´ ì œì–´ */
        #loginScreen, #setupScreen, #waitingScreen, #mainBoard { display: none; flex-direction: column; width: 100%; }
        #loginScreen { display: flex; }

        /* 1. ì…ì¥ & ì‘ì„± í™”ë©´ */
        .subject-box { background: var(--gemini-hover); color: var(--gemini-text); padding: 15px; border-radius: 12px; margin: 15px 0; border: 1px solid var(--gemini-border); display: flex; align-items: center; }
        .setup-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; margin: 20px 0; }
        .setup-input { border-radius: 8px; text-align: center; padding: 5px; font-size: 0.9rem; }

        /* 3. ëŒ€ê¸°ì‹¤ */
        .wait-list { background: var(--gemini-bg); border: 1px solid var(--gemini-border); border-radius: 12px; padding: 15px; width: 100%; margin-bottom: 20px; }
        .wait-item { padding: 10px; border-bottom: 1px solid var(--gemini-border); color: var(--gemini-text); display: flex; align-items: center; }
        .wait-item::before { content: 'â—'; color: var(--gemini-blue); margin-right: 10px; font-size: 0.8rem; }

        /* 4. ë©”ì¸ ê²Œì„ (í„´ & ë¹™ê³ íŒ) - ìœ„ì¥ ëª¨ë“œ */
        .broadcaster { background: var(--gemini-hover); color: var(--gemini-text); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--gemini-blue); display: flex; align-items: flex-start; }
        .turn-alert { background: transparent; color: var(--gemini-subtext); padding: 10px 0; margin-bottom: 10px; font-weight: 500; border-bottom: 1px solid var(--gemini-border); }
        
        /* ë‚´ í„´ì¼ ë•Œ ê°•ì¡° (ì€ì€í•˜ê²Œ) */
        .turn-alert.my-turn { color: var(--gemini-blue); font-weight: bold; }
        .turn-alert.my-turn::before { content: 'âœ¨ '; }

        .leaderboard { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .player-badge { background: var(--gemini-sidebar); border: 1px solid var(--gemini-border); padding: 4px 12px; border-radius: 16px; font-size: 0.85rem; color: var(--gemini-subtext); }
        .player-badge.active-turn { background: var(--gemini-light-blue); color: var(--gemini-blue); border-color: var(--gemini-blue); font-weight: 600; }

        /* ë¹™ê³  ê·¸ë¦¬ë“œ (ë°ì´í„° í…Œì´ë¸”ì²˜ëŸ¼ ìœ„ì¥) */
        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1px; background: var(--gemini-border); border: 1px solid var(--gemini-border); border-radius: 8px; overflow: hidden; margin-bottom: 20px; }
        .bingo-cell { background-color: var(--gemini-bg); aspect-ratio: 1 / 1; display: flex; justify-content: center; align-items: center; padding: 4px; font-size: 0.85rem; color: var(--gemini-text); cursor: pointer; user-select: none; transition: 0.2s; word-break: break-word; position: relative; text-align: center; }
        .bingo-cell:hover { background-color: var(--gemini-hover); }
        
        /* í„´ ì•„ë‹ ë•Œ í´ë¦­ ì‹œ í”ë“¤ë¦¼ íš¨ê³¼ */
        @keyframes shake-not-turn { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-3px); background: #fff0f0; } 75% { transform: translateX(3px); background: #fff0f0; } }
        .bingo-cell.shake-it { animation: shake-not-turn 0.3s; cursor: not-allowed; color: #d93025; }

        /* ë„ì¥ ì°íŒ ìƒíƒœ (ì²´í¬ë°•ìŠ¤ì²˜ëŸ¼ ìœ„ì¥) */
        .bingo-cell.stamped { background-color: var(--gemini-light-blue); color: var(--gemini-blue); font-weight: 600; }
        .bingo-cell.stamped::after { content: 'âœ“'; position: absolute; top: 2px; right: 4px; font-size: 1rem; color: var(--gemini-blue); opacity: 0.7; }

        /* ì‹¤ì‹œê°„ ì±„íŒ…ë°© (AI ëŒ€í™” ê¸°ë¡ì²˜ëŸ¼ ìœ„ì¥) */
        .chat-container { border-top: 1px solid var(--gemini-border); padding-top: 20px; display: flex; flex-direction: column; height: 300px; }
        .chat-messages { flex: 1; overflow-y: auto; padding-right: 5px; display: flex; flex-direction: column; gap: 15px; }
        .chat-msg { display: flex; flex-direction: column; max-width: 85%; }
        .chat-msg.mine { align-self: flex-end; align-items: flex-end; }
        .chat-sender { font-size: 0.8rem; color: var(--gemini-subtext); margin-bottom: 4px; }
        .chat-bubble { background: var(--gemini-sidebar); padding: 10px 15px; border-radius: 18px; border-top-left-radius: 4px; color: var(--gemini-text); line-height: 1.4; }
        .chat-msg.mine .chat-bubble { background: var(--gemini-light-blue); color: var(--gemini-text); border-radius: 18px; border-top-right-radius: 4px; }
        .chat-msg.system { align-self: center; background: transparent; color: var(--gemini-subtext); font-size: 0.85rem; text-align: center; margin: 10px 0; }
        
        .chat-input-row { display: flex; gap: 10px; margin-top: 15px; align-items: center; background: var(--gemini-bg); padding: 5px; border-radius: 30px; border: 1px solid var(--gemini-border); }
        .chat-input { border: none; padding: 10px 15px; flex: 1; border-radius: 0; background: transparent; }
        .chat-input:focus { box-shadow: none; }
        .btn-send { background: transparent; border: none; color: var(--gemini-blue); cursor: pointer; padding: 10px; display: flex; align-items: center; }
        
        /* ìš°ìŠ¹ì ë°œí‘œ (ê²°ê³¼ ìš”ì•½ì²˜ëŸ¼ ìœ„ì¥) */
        #winnerOverlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); color: var(--gemini-text); flex-direction: column; align-items: center; justify-content: center; z-index: 10; padding: 20px; box-sizing: border-box; backdrop-filter: blur(5px); }
        .winner-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1px; background: var(--gemini-border); border: 1px solid var(--gemini-border); width: 100%; max-width: 400px; margin: 20px 0; }
        .w-cell { background: var(--gemini-bg); aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; padding: 2px; text-align: center; }
        .w-cell.stamped { background: var(--gemini-light-blue); color: var(--gemini-blue); font-weight: bold; }

        @media (max-width: 500px) { .setup-input, .bingo-cell { font-size: 0.75rem; } }
    </style>
</head>
<body>

<div class="app-container">
    <div class="fake-header">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" fill="#1a73e8"/></svg>
        <span>Gemini Advanced (ì—…ë¬´ ë³´ì¡°)</span>
    </div>

    <div class="main-content">
        <div class="container" id="loginScreen">
            <h1>ì•ˆë…•í•˜ì„¸ìš”, <br>ì˜¤ëŠ˜ì˜ ì—…ë¬´ í˜‘ì—… ì„¸ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.</h1>
            <p>ì°¸ì—¬ë¥¼ ìœ„í•´ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            
            <div class="subject-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#444746" style="margin-right:10px;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                í˜„ì¬ ì„¸ì…˜ ì£¼ì œ: <strong id="loginSubjectText" style="margin-left: 5px; color: var(--gemini-blue);">ë¡œë”© ì¤‘...</strong>
            </div>
            <button class="btn-secondary" style="margin-bottom: 25px; width: fit-content;" onclick="pickRandomTopic()">ì£¼ì œ ìƒˆë¡œê³ ì¹¨</button>

            <div style="display: flex; gap: 10px; width: 100%;">
                <input type="text" id="playerName" class="login-input" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" required autocomplete="off" onkeypress="if(event.key==='Enter') enterSetup()">
                <button class="btn-primary" onclick="enterSetup()">ì„¸ì…˜ ì°¸ì—¬</button>
            </div>
        </div>

        <div class="container" id="setupScreen">
            <h2>ë°ì´í„° ì…ë ¥ ë‹¨ê³„</h2>
            <p>ì£¼ì œì— ë§ëŠ” í‚¤ì›Œë“œ 25ê°œë¥¼ ì…ë ¥í•˜ì—¬ ë°ì´í„°ì…‹ì„ êµ¬ì„±í•´ì£¼ì„¸ìš”.<br>ì£¼ì œ: <strong id="setupSubjectText" style="color: var(--gemini-blue);"></strong></p>
            
            <div class="setup-grid" id="setupGrid"></div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                <button onclick="fillTestNumbers()" style="background: transparent; border: none; color: var(--gemini-subtext); cursor: pointer; font-size: 0.9rem;">(í…ŒìŠ¤íŠ¸ ë°ì´í„° ìë™ ì…ë ¥)</button>
                <button class="btn-primary" onclick="submitBoard()">ì…ë ¥ ì™„ë£Œ</button>
            </div>
        </div>

        <div class="container" id="waitingScreen">
            <h2>ì°¸ì—¬ì ëŒ€ê¸° ì¤‘</h2>
            <p>ëª¨ë“  ì°¸ì—¬ìê°€ ë°ì´í„° ì…ë ¥ì„ ì™„ë£Œí•˜ë©´ ì„¸ì…˜ì´ ì‹œì‘ë©ë‹ˆë‹¤.<br>ì…ë ¥ ì™„ë£Œ ìˆœì„œëŒ€ë¡œ ë°œì–¸ê¶Œ(í„´)ì´ ë¶€ì—¬ë©ë‹ˆë‹¤.</p>
            
            <div class="wait-list" id="readyPlayerList"></div>

            <button class="btn-primary" style="width: 100%;" onclick="startGame()">ëª¨ë“  ì°¸ì—¬ì ì¤€ë¹„ ì™„ë£Œ, ì„¸ì…˜ ì‹œì‘</button>
        </div>

        <div class="container" id="mainBoard">
            
            <div id="winnerOverlay">
                <h2 style="color: var(--gemini-blue);">ğŸ‰ ì„¸ì…˜ ëª©í‘œ ë‹¬ì„±!</h2>
                <p><strong id="winnerNameDisplay">ëˆ„êµ°ê°€</strong>ë‹˜ì´ ê°€ì¥ ë¨¼ì € ë°ì´í„°ë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.</p>
                <div class="winner-grid" id="winnerGrid"></div>
                <button class="btn-secondary" style="margin-top: 25px;" onclick="resetAllGame()">ìƒˆ ì„¸ì…˜ ì‹œì‘</button>
            </div>

            <div id="turnAlertBox" class="turn-alert">ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì¤‘...</div>
            <div class="broadcaster">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#1a73e8" style="margin-right: 10px; min-width: 24px;"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
                <div id="broadcasterDisplay">ìµœê·¼ ê³µìœ ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>